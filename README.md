# Тестовое задание (Symfony)

## Инструкция по запуску:
### Требования:

**PHP:** Убедитесь, что у вас установлена версия PHP 8.1 или выше.

**Composer:** Убедитесь, что у вас установлен Composer.

**База данных:** Убедитесь, что у вас установлена и настроена база данных (MySQL/MariaDB).

### Шаги по запуску проекта:
1. Клонировать репозиторий:
   ```
   git clone https://github.com/cosmopolityan/sym_api.git
   ```
2. Перейти в корень проекта и установить зависимости:
   ```
   composer install
   ```
3. Настроить переменные окружения в файле `.env` в строке:
   ```
   DATABASE_URL="mysql://db_user:db_password@127.0.0.1:3306/db_name"
   ```
  Заменить `db_user`, `db_password`, `127.0.0.1`, `3306`, и `db_name` на соответствующие значения для вашей базы данных.

4. Любым удобным для вас способом создать базу данных, импортировать дамп [symtest.sql](https://github.com/cosmopolityan/sym_api/blob/main/symtest.sql)
5. Запустить сервер:
   ```
   symfony server:start
   ```
6. Открыть в браузере:
   ```
   http://127.0.0.1:8000
   ```
7. Список доступных эндпойнтов API доступен здесь: [api.yaml](https://github.com/cosmopolityan/sym_api/blob/main/api.yaml) или [здесь](https://cosmopolityan.github.io/sym_api/) для большего удобства.
8. Тестировать CRUD операции для пользователей и филиалов с помощью [Postman](https://www.postman.com/) или через curl.
---
## Задача:
Разработать RESTful API для управления пользователями и филиалами компании. Необходимо самостоятельно спроектировать структуру базы данных и API на основе следующих бизнес-требований.

**Бизнес-требования:**

1. **Пользователи:**
    - Каждый пользователь имеет имя, email, роль и может быть привязан к филиалу.
    - Роли пользователей: user, manager, director.
    - У пользователя может быть только один филиал.
    - Email пользователя должен быть уникальным.
2. **Филиалы:**
    - Каждый филиал имеет название, адрес и директора.
    - Директор филиала — это пользователь с ролью director.
    - У филиала может быть только один директор.
    - Директор не может быть привязан к другому филиалу.
3. **Общие требования:**
    - Необходимо обеспечить целостность данных (например, нельзя удалить филиал, если к нему привязаны пользователи).
    - API должно поддерживать CRUD-операции для пользователей и филиалов.

**Что нужно сделать:**

1. **Спроектировать базу данных:**
    - Самостоятельно определите таблицы, поля, связи и ограничения, которые необходимы для реализации бизнес-требований.
    - Убедитесь, что структура базы данных обеспечивает целостность данных и соответствует требованиям.
2. **Реализовать RESTful API:**
    - Спроектируйте и реализуйте RESTful API для управления пользователями и филиалами.
    - API должно поддерживать стандартные CRUD-операции (создание, чтение, обновление, удаление) для обеих сущностей.
    - Убедитесь, что API соответствует RESTful-принципам (использование HTTP-методов, статусных кодов и т.д.).
3. **Валидация:**
    - Реализуйте валидацию данных на уровне API (например, проверка уникальности email, корректность ролей, наличие директора у филиала и т.д.).
4. **Дополнительные требования:**
    - Используйте Doctrine ORM для работы с базой данных.
    - Используйте Symfony Serializer для сериализации/десериализации данных.
    - Реализуйте обработку ошибок (например, 404 если пользователь или филиал не найдены, 400 при невалидных данных).
    - Напишите unit-тесты для сервисов и функциональные тесты для контроллеров.

**Что нужно предоставить:**

1. Исходный код проекта.
2. Описание структуры базы данных (например, в виде SQL-дампов или миграций Doctrine).
3. Описание API (например, в формате OpenAPI/Swagger или просто список доступных эндпоинтов с примерами запросов и ответов).
4. Инструкцию по запуску проекта (например, как установить зависимости, настроить базу данных и запустить сервер).

**Будет плюсом:**

- Использование DTO для передачи данных между слоями.
- Реализация пагинации и фильтрации для методов получения списков.
- Использование фикстур для заполнения базы данных тестовыми данными.